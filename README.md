# Interpretable-CNN-for-SSW-identification
# CNN
This is a portable pack for training 2D zonal wind (U)/geopotential height (Z) fields with CNN + testing for spatial dependecies.

There are 3 types of .py used for training, testing and plotting figures respectively. Among the three .py for training, testing and plotting, since the latter will read the files generated by the former (model parameters, test results), the latter cannot be executed until the execution of the former .py is completed. (After training/ test run is completed, there will be lines of text showing the end of run and the elapsed time.)

## Training
The codes for training are **CNN_train_U.py** and **CNN_train_Z.py**.

If the device supports NVIDIA GPU then use GPU, otherwise use CPU.
```python
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
```

You can adjust the learning rate, weight decay and training epochs here:
```python
optimizer = optim.SGD(model.parameters(), lr=0.001, weight_decay=0.002)

EPOCHS = 400
```

After the training is done, there will be two lines of text showing the end of run and the elapsed time.
```
Finish training & validating
Time used: 00h 09m 20s
```

The trained model parameters will be stored under ``CNN/models/`` as **CNN_statedict_trainwithU.pt** or **CNN_statedict_trainwithZ.pt**.

The accuracy and loss with epoch will be plotted and saved under ``CNN/figures/`` as **CNN_lossnacc_U.png** or **CNN_lossnacc_Z.png**

&ensp;

## Testing
The codes for training are **CNN_interpret_U.py** and **CNN_interpret_Z.py**.

If the device supports NVIDIA GPU then use GPU, otherwise use CPU.
```python
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
```

The default is to take 100 samples from 780 EXP2 SSW/non-SSW events and repeat 10 times, making a total of 1,000 tests. You can change this with the variables ``size`` and ``times``.
The variable ``zeros_len`` are the side length of the mask (in grid points). Please change it when you execute a new test with a different mask size so that a new test result will be generated under ``CNN/models/validation_result_U(or Z)/``. Be sure to run all 6 tests (zeros_len = 3/5/7/9/11/13) before plotting.
```python
# ========== Assign 0 and Validate ==========
size = 100     # draw 100 data at a time
zeros_len = 3  # side length of mask in grid points [3/5/7/9/11/13]
times = 10     # times of validation (size*times = total number of tests)
```

After the training is done, there will be two lines of text showing the end of run and the elapsed time.
```
Finished testing!
Time used: 07h 49m 30s
```

The test results will be stored under ``CNN/models/validation_result_U(or Z)/`` as **CNN_interpret_masksize#.npz**. (The # is the ``zeros_len`` you set.)

&ensp;

## Plot
The codes for plotting figures are **CNN_plot_U.py** and **CNN_plot_Z.py**.

Each of the **CNN_plot_U(or Z).py** generates two figures, one for the test results of 6 kinds of mask size for SSW and one for non-SSW. The figures will be stored under ``CNN/figures/`` with file names **CNN_(n)SSW_errorplot_U(or Z).png**
